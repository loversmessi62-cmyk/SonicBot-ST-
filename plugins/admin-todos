import config from "../config.js";

export default {
    commands: ["todos", "tagall", "invocar"],

    run: async (sock, msg, args, { isGroup, isAdmin, isBotAdmin, groupMetadata }) => {

        const jid = msg.key.remoteJid;

        // Solo grupos
        if (!isGroup)
            return sock.sendMessage(jid, { text: config.messages.group });

        // Solo admins
        if (!isAdmin)
            return sock.sendMessage(jid, { text: config.messages.admin });

        // Bot debe ser admin
        if (!isBotAdmin)
            return sock.sendMessage(jid, { text: config.messages.botAdmin });

        // Texto opcional
        let texto = args.join(" ").trim() || "ğŸ“¢ *AtenciÃ³n a todos!*";

        // Participantes
        const participantes = groupMetadata.participants;
        const menciones = participantes.map(u => u.id);

        // Armar mensaje
        let mensaje = `${texto}\n\n`;
        for (let user of participantes) {
            mensaje += `â¤ @${user.id.split("@")[0]}\n`;
        }

        // Enviar
        await sock.sendMessage(jid, {
            text: mensaje,
            mentions: menciones
        });
    }
};
